services:

    Jul6Art\PushBundle\Annotation\AsyncAnnotationReader:
        calls:
            - [setReader, ['@annotations.reader']]

    Jul6Art\PushBundle\EntityListener\AbstractAsyncEntityListener:
        parent: Jul6Art\CoreBundle\EntityListener\AbstractEntityListener
        abstract: true
        calls:
            - [setBus, ['@messenger.default_bus']]

    Jul6Art\PushBundle\MessageHandler\EntityAsyncEventHandler:
        calls:
            - [setAsyncAnnotationReader, ['@Jul6Art\PushBundle\Annotation\AsyncAnnotationReader']]
            - [setEntityManager, ['@doctrine.orm.entity_manager']]
            - [setEventDispatcher, ['@event_dispatcher']]
        tags:
            - { name: messenger.message_handler }

    Jul6Art\PushBundle\Service\Pusher:
        calls:
            - [setBus, ['@messenger.default_bus']]
            - [setPublisher, ['@Symfony\Component\Mercure\PublisherInterface']]
        arguments:
            - '%push.async%'
            - '%push.enabled%'
